<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Myrtle Beach 2026 Golf Trip Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/public/css/styles.css">
  <style>
    body { font-family: system-ui, sans-serif; background: #f8fafc; margin: 0; }
    .container { max-width: 1000px; margin: 24px auto; background: #fff; border-radius: 12px; box-shadow: 0 4px 16px #0002; padding: 16px; }
    h1 { color: #2563eb; font-size: 2rem; margin-bottom: 12px; }
    .summary-card { background: #f1f5f9; border-radius: 10px; padding: 16px; margin-bottom: 16px; box-shadow: 0 1px 6px #0001; }
    .summary-box { background: #e0f7fa; border-radius: 10px; padding: 12px; margin-top: 18px; box-shadow: 0 1px 6px #0001; }
    .cards-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 16px; margin-bottom: 18px; }
    .participant-card { background: #f9fafb; border-radius: 10px; box-shadow: 0 2px 8px #0001; padding: 12px; display: flex; flex-direction: column; gap: 8px; }
    .condo-group { background: #f3f4f6; border-radius: 10px; padding: 10px; margin-bottom: 14px; box-shadow: 0 1px 4px #0001; }
    table { width: 100%; border-collapse: collapse; margin-top: 14px; }
    th, td { padding: 6px 8px; border-bottom: 1px solid #e5e7eb; }
    th { background: #f1f5f9; text-align: left; }
    tr:last-child td { border-bottom: none; }
    .form-row { margin-bottom: 10px; }
    input, select, textarea { padding: 6px; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 15px; }
    button { background: #2563eb; color: #fff; border: none; padding: 8px 18px; border-radius: 8px; font-size: 16px; cursor: pointer; transition: background 0.2s; }
    button:hover { background: #1d4ed8; }
    .actions { display: flex; gap: 8px; margin-top: 6px; flex-wrap: wrap; }
    .add-row { background: #fef3c7; border-radius: 6px; }
    .status-in { color: #16a34a; }
    .status-out { color: #dc2626; }
    .status-maybe { color: #f59e42; }
    .status-waitlist { color: #6366f1; }
    .status-invited { color: #2563eb; }
    .room-select { width: 90px; }
    #topPricePayBox, #inStatusBox, .summary-card, .summary-box { box-sizing: border-box; }
    @media (max-width: 600px) {
      .container { padding: 4px; }
      h1 { font-size: 1.2rem; }
      .summary-card, #topPricePayBox, #inStatusBox, .summary-box { padding: 8px; margin-bottom: 10px; }
      .cards-grid { grid-template-columns: 1fr; gap: 10px; }
      .condo-group { padding: 6px; margin-bottom: 8px; }
      .participant-card { padding: 8px; gap: 6px; }
      #allParticipantsList div { grid-template-columns: 1fr 1fr; }
      #itineraryBox { padding: 8px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Myrtle Beach 2026 Golf Trip Tracker</h1>
    <div id="tripSummary" class="summary-card"></div>
    <div id="topPricePayBox" style="margin-bottom:18px;max-width:420px;background:#f1f5f9;padding:14px 18px;border-radius:10px;box-shadow:0 1px 6px #0001;">
      <strong>Price:</strong> $792.56 per person incl. lodging, 5 rounds, all taxes/fees (no breakfast).<br>
      <div style="margin:12px 0 0 0;">
        <a href="https://founders.teetimecentralonline.com/golfcentral/guests/Register.aspx?g=8ad2d184-cdb8-4b90-8dc6-55c68c26efe9&ResNum=12972589&arr=3/18/2026" target="_blank" style="display:block;margin-bottom:8px;color:#2563eb;font-weight:600;text-decoration:underline;font-size:1.1em;">TO JOIN THIS GOLF PACKAGE, CLICK HERE</a>
        <div style="font-size:13px;color:#555;margin-bottom:8px;">Or, copy and paste the line below into your browser</div>
        <div style="word-break:break-all;font-size:13px;margin-bottom:12px;">https://founders.teetimecentralonline.com/golfcentral/guests/Register.aspx?g=8ad2d184-cdb8-4b90-8dc6-55c68c26efe9&ResNum=12972589&arr=3/18/2026</div>
        <a href="https://venmo.com/tk-jr" target="_blank" style="color:#2563eb;font-weight:500;text-decoration:underline;">Or pay Tommy via Venmo</a>
      </div>
    </div>
    <div id="itineraryBox" class="summary-card" style="margin-bottom:24px;"></div>
    <form id="itineraryEditForm" class="summary-card" style="margin-bottom:24px; display:none;">
        <strong>Edit Round Itinerary</strong><br>
      <div class="form-row" style="margin-bottom:16px;">
        <label for="totalCost">Total Cost of Trip:
          <input type="number" id="totalCost" name="totalCost" style="width:120px;" min="0" step="1" placeholder="$">
        </label>
      </div>
      <div class="form-row" style="margin-bottom:16px;">
        <label>Extra Night Price Per Condo: <span>$33</span></label>
      </div>
      <div id="itineraryFields"></div>
      <button type="button" id="addRoundBtn">Add Round</button>
      <button type="submit">Save Itinerary</button>
    </form>
    <form id="tripEditForm" style="margin-bottom:24px;">
      <!-- Base Group Size moved to sidebar above Unassigned Golfers -->
        <!-- Extra Night Price Per Condo moved above itinerary -->
      <div class="form-row">
        <!-- Notes field removed -->
      </div>
      <!-- Save Trip Details button removed -->
    </form>
    <h2>Accommodations</h2>
    <button id="addParticipantBtn" style="margin-bottom:12px;">Add Golfer</button>
    <div style="display:flex; gap:32px; align-items:flex-start;">
      <div id="condoGroups" style="flex:3 1 0;"></div>
      <div id="unassignedSidebar" style="flex:1 1 0; min-width:220px; background:#f3f4f6; border-radius:8px; padding:12px;">
        <div class="form-row" style="margin-bottom:16px;">
          <label>Base Group Size:
            <select name="baseGroupSize" id="baseGroupSizeSelect"></select>
          </label>
        </div>
        <strong>Unassigned Golfers</strong>
        <div style="max-height:420px; overflow-y:auto; margin-top:10px;">
          <ul id="unassignedList" style="list-style:none; padding-left:0; margin:0;"></ul>
        </div>
      </div>
    </div>
    <div id="summaryBox" class="summary-box"></div>
  </div>
  <script>
  const STATUS_ORDER = ['in', 'out', 'maybe', 'waitlist', 'invited'];
  const STATUS_LABELS = { invited: 'Invited', in: 'In', maybe: 'Maybe', out: 'Out', waitlist: 'Waitlist' };
  const BASE_GROUP_SIZES = [4, 8, 12, 16, 20, 24];
  const ROUNDS = [
    { course: 'World Tour', date: '2026-03-18', time: '1:17 PM', groupSize: 20 },
    { course: 'Wild Wing Avocet', date: '2026-03-19', time: '9:18 AM', groupSize: 20 },
    { course: 'River Hills', date: '2026-03-20', time: '9:24 AM', groupSize: 20 },
    { course: 'Long Bay', date: '2026-03-21', time: '9:28 AM', groupSize: 20 },
    { course: "MB National King's North", date: '2026-03-22', time: '7:59 AM', groupSize: 20 }
  ];

  let tripId = null;
  let trip = null;
  let participants = [];

  const $ = (sel) => document.querySelector(sel);
  const formatDate = (d) => (d ? new Date(d).toLocaleDateString() : '');
  const tripApi = (path) => (path.includes('?') ? `${path}&myrtleBeach2026=true` : `${path}?myrtleBeach2026=true`);
  const safeNumber = (val) => (val === '' || isNaN(val) ? 0 : parseFloat(val));

  async function updateParticipant(id, body) {
    await fetch(tripApi(`/api/trips/${tripId}/participants/${id}`), {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(body)
    });
    await loadTrip();
  }

  async function loadTrip() {
    const res = await fetch(tripApi('/api/trips'));
    const trips = await res.json();
    trip = trips.find((t) => t.name && t.name.includes('Myrtle Beach'));
    if (!trip) return alert('Trip not found');
    tripId = trip._id;
    window.tripId = trip._id;
    const pRes = await fetch(tripApi(`/api/trips/${trip._id}/participants`));
    participants = await pRes.json();
    renderAll();
  }

  function renderAll() {
    renderTripSummary();
    renderItinerary();
    renderParticipants();
    renderSummary();
  }

  function renderTripSummary() {
    $('#tripSummary').innerHTML = `
      <div><strong>Trip Name:</strong> Myrtle Beach - Barefoot Group 3/18-3/22/26</div>
      <div><strong>Location:</strong> Myrtle Beach, SC</div>
      <div><strong>Arrival:</strong> Wed 3/18/26 - <strong>Departure:</strong> Sun 3/22/26</div>
      <div><strong>Package Type:</strong> 4 Nights / 5 Rounds</div>
      <div><strong>Reservation #:</strong> 12972589 | Myrtle Beach Golf Trips (866-694-2448)</div>
      <div><strong>Price:</strong> $792.56 per person incl. lodging, 5 rounds, all taxes/fees (no breakfast).</div>
    `;
    const baseGroupSizeSelect = $('#baseGroupSizeSelect');
    if (baseGroupSizeSelect) {
      baseGroupSizeSelect.innerHTML = '';
      BASE_GROUP_SIZES.forEach((n) => {
        const opt = document.createElement('option');
        opt.value = n;
        opt.textContent = n;
        if (trip.baseGroupSize == n) opt.selected = true;
        baseGroupSizeSelect.appendChild(opt);
      });
    }
  }

  function renderItinerary() {
      $('#statusSummaryRow')?.remove();
      $('#inStatusBox')?.remove();
      const itineraryBox = $('#itineraryBox');
      if (!itineraryBox) return;
      itineraryBox.innerHTML = `
        <strong>Golf Schedule (${ROUNDS[0]?.groupSize || participants.length} players)</strong><br>
        <ul>${ROUNDS.map((r) => `<li>${formatDate(r.date)}: ${r.course} @ ${r.time}</li>`).join('')}</ul>
      <div id="allParticipantsList" style="margin:18px 0 8px 0;"></div>
    `;

    renderStatusList();

      const inCount = participants.filter((p) => p.status === 'in').length;
      const nextIncrement = Math.ceil(Math.max(inCount, 1) / 4) * 4;
      const needed = Math.max(nextIncrement - inCount, 0);
      const statusRow = document.createElement('div');
      statusRow.id = 'statusSummaryRow';
      statusRow.style.display = 'flex';
      statusRow.style.gap = '12px';
      statusRow.style.flexWrap = 'wrap';
      statusRow.style.alignItems = 'flex-start';

      const explanationBox = document.createElement('div');
      explanationBox.id = 'inStatusBox';
      explanationBox.style.marginBottom = '12px';
      explanationBox.style.maxWidth = '320px';
      explanationBox.style.background = '#f1f5f9';
      explanationBox.style.padding = '14px 18px';
      explanationBox.style.borderRadius = '10px';
      explanationBox.style.boxShadow = '0 1px 6px #0001';
      explanationBox.innerHTML = `<strong>Confirmed Golfers:</strong> <span style='color:#2563eb;'>${inCount}</span><br>` +
        (needed > 0
          ? `We need <strong>${needed}</strong> more to reach the next full group of 4.<br>`
          : `We have a full group of <strong>${inCount}</strong>!<br>`
        ) +
        `<span style='font-size:13px;color:#555;'>Condos and tee times are assigned in increments of 4.` +
        (needed === 0 ? ` If adding more, we need to grow to <strong>${nextIncrement + 4}</strong> golfers for the next full group.` : '') +
        `</span>`;
      statusRow.appendChild(explanationBox);

      const summaryBox = document.getElementById('summaryBox');
      if (summaryBox) {
        summaryBox.style.marginTop = '0';
        summaryBox.style.minWidth = '260px';
        statusRow.appendChild(summaryBox);
      }

      itineraryBox.insertAdjacentElement('beforebegin', statusRow);

      $('#itineraryEditForm').style.display = 'none';
    }

  function renderStatusList() {
    if (!Array.isArray(participants) || !participants.length) {
      $('#allParticipantsList').innerHTML = '';
      return;
    }
    const counts = { in: 0, out: 0, maybe: 0, waitlist: 0, invited: 0 };
    participants.forEach((p) => { if (counts.hasOwnProperty(p.status)) counts[p.status]++; });
    const summaryBar = `<div style='margin-bottom:8px;font-weight:500;'>` +
      STATUS_ORDER.map((s) => `<span style='margin-right:18px;'>${STATUS_LABELS[s]}: <span style='color:#2563eb;'>${counts[s]}</span></span>`).join('') +
      `</div>`;
    const sorted = [...participants].sort((a, b) => {
      const sa = STATUS_ORDER.indexOf(a.status);
      const sb = STATUS_ORDER.indexOf(b.status);
      if (sa !== sb) return sa - sb;
      return (a.name || '').localeCompare(b.name || '');
    });
    const colCount = 4;
    const perCol = Math.ceil(sorted.length / colCount);
    const cols = Array.from({ length: colCount }, (_, i) => sorted.slice(i * perCol, (i + 1) * perCol));
    let tableHtml = `<strong>Golfer Status</strong>${summaryBar}<div style='display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-top:8px;'>`;
    for (const col of cols) {
      tableHtml += `<ul style='margin:0;padding-left:18px;'>${col.map((p) =>
        `<li>${p.name} <select class='golfer-status-dropdown' data-id='${p._id}' style='font-size:13px;padding:2px 4px;margin-left:4px;'>${STATUS_ORDER.map((opt) => `<option value='${opt}'${p.status === opt ? ' selected' : ''}>${STATUS_LABELS[opt]}</option>`).join('')}</select> <input type='number' class='golfer-paid-input' data-id='${p._id}' value='${(p.totalPaidAmount || 0).toFixed(2)}' min='0' step='0.01' style='width:60px;font-size:13px;margin-left:4px;' placeholder='Paid'></li>`
      ).join('')}</ul>`;
    }
    tableHtml += `</div>`;
    $('#allParticipantsList').innerHTML = tableHtml;

    document.querySelectorAll('.golfer-status-dropdown').forEach((sel) => {
      sel.addEventListener('change', async function () {
        await updateParticipant(this.dataset.id, { status: this.value });
      });
    });
    document.querySelectorAll('.golfer-paid-input').forEach((input) => {
      input.addEventListener('change', async function () {
        await updateParticipant(this.dataset.id, { totalPaidAmount: safeNumber(this.value) });
      });
    });
  }

  document.addEventListener('click', function (e) {
    if (e.target && e.target.id === 'editItineraryBtn') renderItineraryEditForm();
  });

  function renderItineraryEditForm() {
    const tripRounds = trip?.rounds || [];
    const fieldsDiv = document.getElementById('itineraryFields');
    fieldsDiv.innerHTML = '';
    (tripRounds.length ? tripRounds : [
      { date: '2026-03-22', course: 'MB National Kings North', time: '08:17 AM', groupSize: 12, confirmation: '17780283' }
    ]).forEach((r, idx) => {
      const row = document.createElement('div');
      row.style.marginBottom = '8px';
      row.innerHTML = `
        <input type="date" value="${r.date}" class="round-date" data-idx="${idx}" style="width:120px;">
        <input type="text" value="${r.course}" placeholder="Course" class="round-course" data-idx="${idx}" style="width:160px;">
        <input type="text" value="${r.time}" placeholder="Time" class="round-time" data-idx="${idx}" style="width:90px;">
        <input type="number" value="${r.groupSize || ''}" placeholder="Group Size" class="round-group-size" data-idx="${idx}" style="width:90px;">
        <input type="text" value="${r.confirmation || ''}" placeholder="Confirmation" class="round-confirmation" data-idx="${idx}" style="width:120px;">
        <button type="button" class="remove-round-btn" data-idx="${idx}">Remove</button>
      `;
      fieldsDiv.appendChild(row);
    });
    document.getElementById('itineraryEditForm').style.display = '';
  }

  document.getElementById('addRoundBtn').onclick = function () {
    const fieldsDiv = document.getElementById('itineraryFields');
    const idx = fieldsDiv.children.length;
    const row = document.createElement('div');
    row.style.marginBottom = '8px';
    row.innerHTML = `
      <input type="date" class="round-date" data-idx="${idx}" style="width:120px;">
      <input type="text" placeholder="Course" class="round-course" data-idx="${idx}" style="width:160px;">
      <input type="text" placeholder="Time" class="round-time" data-idx="${idx}" style="width:90px;">
      <button type="button" class="remove-round-btn" data-idx="${idx}">Remove</button>
    `;
    fieldsDiv.appendChild(row);
  };

  document.getElementById('itineraryFields').addEventListener('click', function (e) {
    if (e.target.classList.contains('remove-round-btn')) e.target.parentElement.remove();
  });

  document.getElementById('itineraryEditForm').onsubmit = async function (e) {
    e.preventDefault();
    const rounds = [];
    const fieldsDiv = document.getElementById('itineraryFields');
    for (const row of fieldsDiv.children) {
      const date = row.querySelector('.round-date').value;
      const course = row.querySelector('.round-course').value;
      const time = row.querySelector('.round-time').value;
      const groupSize = row.querySelector('.round-group-size')?.value;
      const confirmation = row.querySelector('.round-confirmation')?.value;
      if (date && course && time) rounds.push({ date, course, time, groupSize, confirmation });
    }
    await fetch(tripApi(`/api/trips/${tripId}`), {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ rounds })
    });
    document.getElementById('itineraryEditForm').style.display = 'none';
    await loadTrip();
  };

  $('#tripEditForm').onsubmit = async function (e) {
    e.preventDefault();
    const body = {
      baseGroupSize: +this.baseGroupSize?.value || undefined,
      extraNightPricePerCondo: +this.extraNightPricePerCondo?.value || undefined
    };
    await fetch(tripApi(`/api/trips/${tripId}`), {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(body)
    });
    await loadTrip();
  };

  function renderParticipants() {
    const container = document.getElementById('condoGroups');
    if (!container) return;
    container.innerHTML = '';

    const condoCounts = [0, 0, 0, 0, 0];
    participants.forEach((g) => {
      const m = g.roomAssignment && g.roomAssignment.match(/^Condo (\d+) - Room ([AB])$/);
      if (m) {
        const idx = parseInt(m[1], 10) - 1;
        if (idx >= 0 && idx < 5) condoCounts[idx]++;
      }
    });

    for (let i = 0; i < 5; i++) {
      const div = document.createElement('div');
      div.className = 'condo-group';
      div.innerHTML = `<strong>Condo ${i + 1}</strong><div class="cards-grid"></div>`;
      const grid = div.querySelector('.cards-grid');
      const group = participants.filter((p) => {
        if (!p.roomAssignment) return false;
        const match = p.roomAssignment.match(/^Condo (\d+) - Room ([AB])$/);
        return match && parseInt(match[1], 10) === i + 1;
      });
      for (const p of group) {
        const match = p.roomAssignment && p.roomAssignment.match(/^Condo (\d+) - Room ([AB])$/);
        const room = match ? match[2] : '';
        const currentCondo = match ? parseInt(match[1], 10) : null;
        let moveOptions = `<option value="unassigned">Unassigned List</option>`;
        for (let c = 1; c <= 5; c++) {
          if (c !== currentCondo && condoCounts[c - 1] < 4) moveOptions += `<option value="${c}">Condo ${c}</option>`;
        }
        const card = document.createElement('div');
        card.className = 'participant-card';
        card.innerHTML = `
          <div><strong>Name:</strong> <input type="text" value="${p.name}" data-id="${p._id}" class="name-input"></div>
          <div><strong>Bedroom:</strong> <select class="room-select" data-id="${p._id}">
            <option value="A"${room === 'A' ? ' selected' : ''}>A</option>
            <option value="B"${room === 'B' ? ' selected' : ''}>B</option>
          </select></div>
          <div><strong>Extra Night:</strong> <input type="checkbox" ${p.wantsExtraNight ? 'checked' : ''} class="extra-night-input" data-id="${p._id}"></div>
          <div class="actions">
            <button class="remove-condo-btn" data-id="${p._id}">UNASSIGN</button>
            ${moveOptions ? `<select class="move-condo-select" data-id="${p._id}" style="margin-left:8px;"><option value="">Move to...</option>${moveOptions}</select>` : ''}
          </div>
        `;
        grid.appendChild(card);
      }
      container.appendChild(div);
    }

    const unassigned = participants.filter((p) => !p.roomAssignment);
    const ul = document.getElementById('unassignedList');
    const unassignedSidebar = document.getElementById('unassignedSidebar');
    if (!ul || !unassignedSidebar) return;
    ul.innerHTML = '';
    unassigned.forEach((p) => {
      const li = document.createElement('li');
      li.style.marginBottom = '18px';
      li.style.background = '#f9fafb';
      li.style.borderRadius = '8px';
      li.style.boxShadow = '0 1px 4px #0001';
      li.style.padding = '14px';
      li.innerHTML = `
        <div style="margin-bottom:8px;"><strong>${p.name}</strong></div>
        <div style="margin-bottom:8px;"><label style="font-weight:500;">Condo:</label> <select class="assign-condo-select" data-id="${p._id}" style="width:60px;text-align:center;">
          <option value="">--</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
        </select></div>
        <div><button class="remove-golfer-btn" data-id="${p._id}" style="background:#dc2626;color:#fff;border:none;padding:4px 14px;border-radius:6px;">DELETE</button></div>
      `;
      ul.appendChild(li);
    });

    if (unassignedSidebar._changeHandler) unassignedSidebar.removeEventListener('change', unassignedSidebar._changeHandler);
    unassignedSidebar._changeHandler = async function (e) {
      if (e.target.classList.contains('assign-condo-select')) {
        const condoNum = e.target.value;
        const id = e.target.dataset.id;
        if (!condoNum || condoNum < 1 || condoNum > 5) return;
        await updateParticipant(id, { roomAssignment: `Condo ${condoNum} - Room A` });
      }
    };
    unassignedSidebar.addEventListener('change', unassignedSidebar._changeHandler);

    if (unassignedSidebar._removeHandler) unassignedSidebar.removeEventListener('click', unassignedSidebar._removeHandler);
    unassignedSidebar._removeHandler = async function (e) {
      if (e.target.classList.contains('remove-golfer-btn')) {
        const id = e.target.dataset.id;
        if (!confirm('Remove this golfer from the event?')) return;
        await fetch(tripApi(`/api/trips/${tripId}/participants/${id}`), { method: 'DELETE' });
        await loadTrip();
      }
    };
    unassignedSidebar.addEventListener('click', unassignedSidebar._removeHandler);
  }

  const condoGroups = document.getElementById('condoGroups');
  if (condoGroups) {
    condoGroups.addEventListener('click', async function (e) {
      if (e.target.classList.contains('move-condo-select')) {
        const id = e.target.dataset.id;
        const val = e.target.value;
        if (!val) return;
        if (val === 'unassigned') {
          await updateParticipant(id, { roomAssignment: null });
        } else if (val >= 1 && val <= 5) {
          await updateParticipant(id, { roomAssignment: `Condo ${val} - Room A` });
        }
      }
      if (e.target.classList.contains('remove-condo-btn')) {
        const id = e.target.dataset.id;
        await updateParticipant(id, { roomAssignment: null });
      }
    });
  }

  $('#addParticipantBtn').onclick = async function () {
    const name = prompt('Golfer name:');
    if (!name) return;
    await fetch(tripApi(`/api/trips/${tripId}/participants`), {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ name, status: 'invited' })
    });
    await loadTrip();
  };

  function renderSummary() {
    const total = participants.length;
    const counts = { in: 0, maybe: 0, out: 0, waitlist: 0, invited: 0 };
    let depositTotal = 0;
    let extraNightCount = 0;
    participants.forEach((p) => {
      const status = counts.hasOwnProperty(p.status) ? p.status : 'invited';
      counts[status] = (counts[status] || 0) + 1;
      depositTotal += Number(p.totalPaidAmount || p.depositPaidAmount || 0);
      if (p.wantsExtraNight) extraNightCount++;
    });
    const extraNightCost = 33;
    const extraNightTotal = extraNightCount * extraNightCost;
    $('#summaryBox').innerHTML = `
      <strong>Live Summary</strong><br>
      Total participants: ${total}<br>
      In: ${counts.in} | Maybe: ${counts.maybe} | Out: ${counts.out} | Waitlist: ${counts.waitlist} | Invited: ${counts.invited}<br>
      Total deposits received: $${depositTotal.toFixed(2)}<br>
      Wants extra night: ${extraNightCount} &times; $${extraNightCost} = <strong>$${extraNightTotal}</strong>
    `;
  }

  window.addEventListener('DOMContentLoaded', loadTrip);
</script>
</body>
</html>
