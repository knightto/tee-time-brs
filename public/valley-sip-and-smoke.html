<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Valley Sip and Smoke | The Knight Club Lounge</title>
  <link rel="icon" type="image/png" href="/assets/knight-club-icon.png">
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Cinzel:wght@500;700;800&family=Manrope:wght@400;500;700&display=swap");
    :root {
      --bg: #0f0907;
      --panel: rgba(25, 17, 12, 0.9);
      --panel-soft: rgba(40, 28, 21, 0.9);
      --accent: #d2933d;
      --accent-soft: #f0d3a3;
      --ink: #f8eee0;
      --ink-soft: #cbb79c;
      --border: rgba(255, 234, 211, 0.16);
      --ok: #7dcf9c;
      --warn: #e2b26b;
      --shadow: 0 18px 42px rgba(0, 0, 0, 0.4);
    }
    * { box-sizing: border-box; }
    html, body { min-height: 100%; }
    body {
      margin: 0;
      font-family: "Manrope", "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      color: var(--ink);
      background:
        linear-gradient(120deg, rgba(12, 7, 5, 0.86) 0%, rgba(10, 7, 5, 0.78) 55%, rgba(8, 6, 4, 0.92) 100%),
        radial-gradient(circle at 16% 8%, rgba(221, 151, 70, 0.22), transparent 30%),
        radial-gradient(circle at 76% 2%, rgba(102, 57, 24, 0.34), transparent 34%),
        url("/assets/knight-club-hero.png") center center / cover no-repeat;
      background-color: #0b0705;
      min-height: 100vh;
    }
    .shell {
      max-width: 1080px;
      margin: 0 auto;
      padding: 18px 14px 36px;
    }
    .top {
      position: sticky;
      top: 0;
      z-index: 6;
      border: 1px solid var(--border);
      border-radius: 16px;
      background:
        linear-gradient(145deg, rgba(33, 22, 16, 0.94) 0%, rgba(20, 14, 11, 0.95) 100%),
        url("/assets/knight-club-hero.png") center / cover no-repeat;
      padding: 14px;
      display: grid;
      gap: 10px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(8px);
    }
    .top-head {
      display: grid;
      grid-template-columns: auto 1fr;
      align-items: center;
      gap: 12px;
    }
    .crest {
      width: 56px;
      height: 56px;
      border-radius: 14px;
      border: 1px solid var(--border);
      box-shadow: 0 8px 18px rgba(0, 0, 0, 0.45);
      object-fit: cover;
    }
    .top h1 {
      margin: 0;
      font-size: clamp(1.3rem, 3vw, 1.9rem);
      letter-spacing: 0.6px;
      font-family: "Cinzel", Georgia, "Times New Roman", serif;
      text-transform: uppercase;
      color: #ffdfb6;
      text-shadow: 0 3px 14px rgba(0, 0, 0, 0.45);
    }
    .top small {
      color: var(--ink-soft);
      letter-spacing: 0.2px;
    }
    .row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    .chip {
      border: 1px solid var(--border);
      border-radius: 999px;
      padding: 6px 10px;
      color: var(--ink-soft);
      font-size: 0.82rem;
      background: rgba(255, 255, 255, 0.04);
    }
    .grid {
      margin-top: 14px;
      display: grid;
      grid-template-columns: 1.1fr 1fr;
      gap: 12px;
    }
    .panel {
      border: 1px solid var(--border);
      border-radius: 14px;
      background: linear-gradient(145deg, var(--panel) 0%, rgba(19, 13, 10, 0.92) 100%);
      padding: 14px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(3px);
    }
    .panel h2 {
      margin: 0 0 10px;
      font-size: 1.02rem;
      color: var(--accent-soft);
      letter-spacing: 0.25px;
      font-family: "Cinzel", Georgia, "Times New Roman", serif;
    }
    .facts {
      display: grid;
      gap: 6px;
      font-size: 0.95rem;
      line-height: 1.5;
    }
    .facts strong { color: #fff; }
    .plans {
      display: grid;
      gap: 8px;
    }
    .plan {
      background: var(--panel-soft);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 10px;
    }
    .plan-head {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      font-weight: 700;
    }
    .price { color: var(--accent-soft); }
    .list {
      margin: 0;
      padding-left: 18px;
      color: var(--ink-soft);
      line-height: 1.5;
      font-size: 0.92rem;
    }
    .calendar {
      list-style: none;
      margin: 0;
      padding: 0;
      display: grid;
      gap: 8px;
    }
    .calendar li {
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 10px;
      background: rgba(255, 255, 255, 0.05);
      display: flex;
      justify-content: space-between;
      gap: 8px;
      align-items: center;
    }
    .muted { color: var(--ink-soft); font-size: 0.86rem; }
    .status {
      font-size: 0.78rem;
      border-radius: 999px;
      padding: 4px 8px;
      border: 1px solid var(--border);
      color: #14100d;
      background: var(--ok);
      font-weight: 700;
      white-space: nowrap;
    }
    .status.wait { background: var(--warn); }
    .cta {
      margin-top: 10px;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    .btn {
      text-decoration: none;
      font-weight: 700;
      border-radius: 10px;
      padding: 9px 12px;
      border: 1px solid var(--border);
      color: var(--ink);
      background: #2f241c;
    }
    .btn.primary {
      color: #1a130e;
      background: linear-gradient(160deg, #f2d4a7 0%, #d2933d 100%);
      border-color: rgba(242, 207, 150, 0.5);
    }
    input, select, textarea, button {
      font: inherit;
    }
    .field {
      display: grid;
      gap: 5px;
      margin-bottom: 8px;
    }
    .field input, .field select, .field textarea {
      width: 100%;
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 8px;
      background: rgba(18, 13, 10, 0.92);
      color: var(--ink);
    }
    .tools {
      margin-top: 12px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 12px;
    }
    .tool-card {
      border: 1px solid var(--border);
      border-radius: 12px;
      background: linear-gradient(145deg, rgba(31, 22, 16, 0.94) 0%, rgba(21, 15, 11, 0.95) 100%);
      padding: 12px;
      box-shadow: var(--shadow);
    }
    .tool-card h3 {
      margin: 0 0 8px;
      color: var(--accent-soft);
      font-size: 0.95rem;
    }
    .tool-card p {
      margin: 0 0 8px;
      color: var(--ink-soft);
      font-size: 0.85rem;
    }
    .tool-actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 8px;
    }
    .msg {
      margin-top: 8px;
      font-size: 0.82rem;
      color: var(--accent-soft);
      min-height: 1.1em;
    }
    .table-wrap {
      overflow-x: auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.88rem;
    }
    th, td {
      border-bottom: 1px solid var(--border);
      padding: 8px 6px;
      text-align: left;
      vertical-align: top;
    }
    .tiny {
      padding: 5px 8px;
      border-radius: 7px;
      border: 1px solid var(--border);
      background: #2d241d;
      color: var(--ink);
      cursor: pointer;
      font-weight: 700;
      font-size: 0.77rem;
    }
    .tiny.primary {
      background: linear-gradient(160deg, #f2d4a7 0%, #d2933d 100%);
      color: #1a130e;
    }
    @media (max-width: 880px) {
      .grid { grid-template-columns: 1fr; }
      .top-head { grid-template-columns: 1fr; }
      .crest { width: 48px; height: 48px; }
    }
  </style>
</head>
<body>
  <div class="shell">
    <header class="top">
      <div class="top-head">
        <img class="crest" src="/assets/knight-club-icon.png" alt="Knight Club crest">
        <div>
          <h1>Valley Sip and Smoke</h1>
          <small>The Knight Club Lounge at On Cue - Front Royal, VA</small>
        </div>
      </div>
      <div class="row">
        <span class="chip">Bourbon + cigar nights</span>
        <span class="chip">Member and locker plans</span>
        <span class="chip">Thursday and Sunday schedule</span>
      </div>
    </header>

    <section class="grid">
      <article class="panel">
        <h2>Event Overview</h2>
        <div class="facts">
          <div><strong>Venue:</strong> The Knight Club Lounge at On Cue</div>
          <div><strong>City:</strong> Front Royal, Virginia</div>
          <div><strong>Format:</strong> Social bourbon and cigar sessions with reserve bottle access.</div>
          <div><strong>Host flow:</strong> Member sign-in, check-in, reserve bottle selection, and event roster.</div>
        </div>
        <div class="cta">
          <a class="btn primary" href="mailto:tommy.knight@gmail.com?subject=Valley%20Sip%20and%20Smoke%20Membership">Request Membership</a>
          <a class="btn" href="mailto:tommy.knight@gmail.com?subject=Valley%20Sip%20and%20Smoke%20Question">Ask a Question</a>
        </div>
      </article>

      <article class="panel">
        <h2>Membership Plans</h2>
        <div class="plans">
          <div class="plan">
            <div class="plan-head"><span>Member</span><span class="price">$65 / month</span></div>
            <ul class="list">
              <li>Access to all scheduled sip and smoke nights</li>
              <li>Event RSVP and member check-in participation</li>
              <li>Shared reserve bottle purchase windows</li>
            </ul>
          </div>
          <div class="plan">
            <div class="plan-head"><span>Locker Member</span><span class="price">$95 / month</span></div>
            <ul class="list">
              <li>All member benefits</li>
              <li>Personal locker storage at the venue</li>
              <li>Priority access on reserve releases</li>
            </ul>
          </div>
        </div>
      </article>
    </section>

    <section class="grid">
      <article class="panel">
        <h2>Upcoming Nights</h2>
        <ul class="calendar" id="scheduleList"></ul>
      </article>
      <article class="panel">
        <h2>Operations Notes</h2>
        <ul class="list">
          <li>Doors open at 6:30 PM for Thursday sessions.</li>
          <li>Sunday sessions are hosted as relaxed tasting blocks.</li>
          <li>Check-in desk confirms member passcode access.</li>
          <li>Admin review covers RSVP list, reserve inventory, and attendance export.</li>
        </ul>
        <p class="muted" style="margin-top:10px;">This is now a first-class page in the main Tee Time site, matching the Myrtle trip style and deployment model.</p>
      </article>
    </section>

    <section class="tools">
      <article class="tool-card">
        <h3>Member Sign-In + RSVP</h3>
        <p>Members can sign in and RSVP for a specific event night.</p>
        <form id="memberForm">
          <label class="field">
            <span>Name</span>
            <input id="memberNameInput" type="text" required placeholder="Your name">
          </label>
          <label class="field">
            <span>Member Passcode</span>
            <input id="memberPasscodeInput" type="password" required placeholder="Passcode">
          </label>
          <label class="field">
            <span>Event Night</span>
            <select id="eventSelect" required></select>
          </label>
          <div class="tool-actions">
            <button class="tiny primary" type="submit">Sign In + RSVP</button>
          </div>
          <div class="msg" id="memberMsg"></div>
        </form>
      </article>

      <article class="tool-card">
        <h3>Reserve Bottle Selection</h3>
        <p>Submit reserve bottle requests for a specific event using your member passcode.</p>
        <form id="reserveForm">
          <label class="field">
            <span>Member Name</span>
            <input id="reserveNameInput" type="text" required placeholder="Member name">
          </label>
          <label class="field">
            <span>Member Passcode</span>
            <input id="reservePasscodeInput" type="password" required placeholder="Passcode">
          </label>
          <label class="field">
            <span>Event Night</span>
            <select id="reserveEventSelect" required></select>
          </label>
          <label class="field">
            <span>Bottle</span>
            <select id="reserveBottleSelect" required>
              <option value="">Select a bottle...</option>
              <option value="Weller Antique 107">Weller Antique 107</option>
              <option value="Blanton's Single Barrel">Blanton's Single Barrel</option>
              <option value="Booker's Bourbon">Booker's Bourbon</option>
              <option value="E.H. Taylor Small Batch">E.H. Taylor Small Batch</option>
              <option value="Host Choice">Host Choice</option>
            </select>
          </label>
          <label class="field">
            <span>Request Notes</span>
            <textarea id="reserveNotesInput" rows="2" placeholder="Optional notes"></textarea>
          </label>
          <div class="tool-actions">
            <button class="tiny primary" type="submit">Submit Request</button>
          </div>
          <div class="msg" id="reserveMsg"></div>
        </form>
      </article>
    </section>

    <section class="grid">
      <article class="panel">
        <h2>Event Roster + Check-In</h2>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Name</th>
                <th>Event</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="rosterBody"></tbody>
          </table>
        </div>
        <div class="tool-actions">
          <button id="exportRosterBtn" class="tiny">Export Attendance CSV</button>
          <button id="clearRosterBtn" class="tiny">Clear Shared Data</button>
        </div>
      </article>

      <article class="panel">
        <h2>Reserve Request Queue</h2>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Member</th>
                <th>Event</th>
                <th>Bottle</th>
                <th>Notes</th>
              </tr>
            </thead>
            <tbody id="reserveBody"></tbody>
          </table>
        </div>
      </article>
    </section>
  </div>

  <script>
    let appState = { schedule: [], attendees: [], reserveRequests: [] };

    function escapeHtml(val) {
      return String(val || "")
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#39;");
    }

    function fmtDate(d) {
      return new Date(d).toLocaleDateString(undefined, { weekday: "short", month: "short", day: "numeric", year: "numeric" });
    }

    async function api(path, opts = {}) {
      const res = await fetch(path, opts);
      let data = null;
      try {
        data = await res.json();
      } catch {
        data = null;
      }
      if (!res.ok) throw new Error((data && data.error) || `Request failed (${res.status})`);
      return data;
    }

    function fmtEventLabel(attendee, schedule) {
      const e = schedule.find((x) => x.id === attendee.eventId);
      if (e) return `${e.label} (${fmtDate(e.date)})`;
      if (attendee.eventLabel) return attendee.eventLabel;
      return "Unknown event";
    }

    function toICSDate(d, hour, minute) {
      const x = new Date(d);
      x.setHours(hour, minute, 0, 0);
      const y = x.getUTCFullYear();
      const m = String(x.getUTCMonth() + 1).padStart(2, "0");
      const day = String(x.getUTCDate()).padStart(2, "0");
      const hh = String(x.getUTCHours()).padStart(2, "0");
      const mm = String(x.getUTCMinutes()).padStart(2, "0");
      return `${y}${m}${day}T${hh}${mm}00Z`;
    }

    function downloadEventICS(item) {
      const start = toICSDate(item.date, item.hour, item.minute);
      const end = toICSDate(item.date, item.hour + 2, item.minute);
      const uid = `${item.id}-${Date.now()}@valleysipsmoke`;
      const ics = [
        "BEGIN:VCALENDAR",
        "VERSION:2.0",
        "PRODID:-//Valley Sip and Smoke//EN",
        "BEGIN:VEVENT",
        `UID:${uid}`,
        `DTSTAMP:${toICSDate(new Date(), 0, 0)}`,
        `DTSTART:${start}`,
        `DTEND:${end}`,
        `SUMMARY:${item.label}`,
        "LOCATION:The Knight Club Lounge at On Cue, Front Royal, VA",
        "DESCRIPTION:Valley Sip and Smoke event night",
        "END:VEVENT",
        "END:VCALENDAR"
      ].join("\r\n");
      const blob = new Blob([ics], { type: "text/calendar;charset=utf-8;" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = `${item.label.replace(/\s+/g, "-").toLowerCase()}.ics`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function renderEventSelect(schedule) {
      const optionHtml = schedule.map((item) => `<option value="${item.id}">${item.label} - ${fmtDate(item.date)}</option>`).join("");
      const select = document.getElementById("eventSelect");
      if (select) select.innerHTML = optionHtml;
      const reserveSelect = document.getElementById("reserveEventSelect");
      if (reserveSelect) reserveSelect.innerHTML = optionHtml;
    }

    function renderSchedule(schedule) {
      const list = document.getElementById("scheduleList");
      if (!list) return;
      list.innerHTML = schedule.map((item) => {
        const wait = item.state.toLowerCase().includes("wait");
        return `
          <li>
            <div>
              <div><strong>${item.label}</strong></div>
              <div class="muted">${fmtDate(item.date)}</div>
            </div>
            <div style="display:grid;justify-items:end;gap:6px;">
              <span class="status${wait ? " wait" : ""}">${item.state}</span>
              <div class="tool-actions" style="margin:0;">
                <button class="tiny" data-action="rsvp" data-event-id="${item.id}">RSVP</button>
                <button class="tiny" data-action="ics" data-event-id="${item.id}">Add to Calendar</button>
              </div>
            </div>
          </li>
        `;
      }).join("");
    }

    function renderRoster(state, schedule) {
      const body = document.getElementById("rosterBody");
      if (!body) return;
      if (!state.attendees.length) {
        body.innerHTML = `<tr><td colspan="4" class="muted">No members signed in yet.</td></tr>`;
        return;
      }
      body.innerHTML = state.attendees.map((a) => `
        <tr>
          <td>${escapeHtml(a.name)}</td>
          <td>${escapeHtml(fmtEventLabel(a, schedule))}</td>
          <td>${a.checkedIn ? "Checked In" : "RSVP Only"}</td>
          <td>
            <button class="tiny${a.checkedIn ? "" : " primary"}" data-action="toggle-checkin" data-id="${a._id}">
              ${a.checkedIn ? "Undo Check-In" : "Mark Check-In"}
            </button>
            <button class="tiny" data-action="remove-attendee" data-id="${a._id}">Remove</button>
          </td>
        </tr>
      `).join("");
    }

    function renderReserveQueue(state) {
      const body = document.getElementById("reserveBody");
      if (!body) return;
      if (!state.reserveRequests.length) {
        body.innerHTML = `<tr><td colspan="4" class="muted">No reserve requests submitted.</td></tr>`;
        return;
      }
      body.innerHTML = state.reserveRequests.map((r) => `
        <tr>
          <td>${escapeHtml(r.name)}</td>
          <td>${escapeHtml(fmtEventLabel(r, appState.schedule))}</td>
          <td>${escapeHtml(r.bottle)}</td>
          <td>${escapeHtml(r.notes || "-")}</td>
        </tr>
      `).join("");
    }

    function exportRoster(state, schedule) {
      if (!state.attendees.length) return;
      const rows = [["name", "event", "status"]].concat(
        state.attendees.map((a) => [
          a.name,
          fmtEventLabel(a, schedule),
          a.checkedIn ? "checked_in" : "rsvp_only"
        ])
      );
      const csv = rows.map((r) => r.map((c) => `"${String(c).replace(/"/g, '""')}"`).join(",")).join("\n");
      const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "valley-sip-and-smoke-attendance.csv";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    async function refreshState() {
      const data = await api("/api/valley/state");
      appState = {
        schedule: Array.isArray(data.schedule) ? data.schedule : [],
        attendees: Array.isArray(data.attendees) ? data.attendees : [],
        reserveRequests: Array.isArray(data.reserveRequests) ? data.reserveRequests : []
      };
      renderSchedule(appState.schedule);
      renderEventSelect(appState.schedule);
      renderRoster(appState, appState.schedule);
      renderReserveQueue(appState);
    }

    window.addEventListener("DOMContentLoaded", async () => {
      const memberForm = document.getElementById("memberForm");
      const reserveForm = document.getElementById("reserveForm");
      const memberMsg = document.getElementById("memberMsg");
      const reserveMsg = document.getElementById("reserveMsg");
      const eventSelect = document.getElementById("eventSelect");
      const reserveEventSelect = document.getElementById("reserveEventSelect");

      try {
        await refreshState();
      } catch (err) {
        memberMsg.textContent = `Unable to load Valley data: ${err.message}`;
      }

      const scheduleList = document.getElementById("scheduleList");
      if (scheduleList) {
        scheduleList.addEventListener("click", (e) => {
          const btn = e.target.closest("button");
          if (!btn) return;
          const eventId = btn.dataset.eventId;
          const item = appState.schedule.find((x) => x.id === eventId);
          if (!item) return;
          if (btn.dataset.action === "rsvp") {
            if (eventSelect) eventSelect.value = eventId;
            const nameInput = document.getElementById("memberNameInput");
            if (nameInput) nameInput.focus();
          }
          if (btn.dataset.action === "ics") {
            downloadEventICS(item);
          }
        });
      }

      if (memberForm) {
        memberForm.addEventListener("submit", async (e) => {
          e.preventDefault();
          const name = (document.getElementById("memberNameInput")?.value || "").trim();
          const passcode = (document.getElementById("memberPasscodeInput")?.value || "").trim();
          const eventId = (eventSelect?.value || "").trim();
          if (!name || !eventId) {
            memberMsg.textContent = "Enter your name and choose an event.";
            return;
          }
          try {
            await api("/api/valley/attendees", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ name, passcode, eventId })
            });
            await refreshState();
            memberForm.reset();
            renderEventSelect(appState.schedule);
            memberMsg.textContent = "Signed in and RSVP saved.";
          } catch (err) {
            memberMsg.textContent = err.message;
          }
        });
      }

      if (reserveForm) {
        reserveForm.addEventListener("submit", async (e) => {
          e.preventDefault();
          const name = (document.getElementById("reserveNameInput")?.value || "").trim();
          const passcode = (document.getElementById("reservePasscodeInput")?.value || "").trim();
          const eventId = (reserveEventSelect?.value || "").trim();
          const bottle = (document.getElementById("reserveBottleSelect")?.value || "").trim();
          const notes = (document.getElementById("reserveNotesInput")?.value || "").trim();
          if (!name || !passcode || !eventId || !bottle) {
            reserveMsg.textContent = "Enter member name/passcode, event, and bottle.";
            return;
          }
          try {
            await api("/api/valley/reserve-requests", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ name, passcode, eventId, bottle, notes })
            });
            await refreshState();
            reserveForm.reset();
            renderEventSelect(appState.schedule);
            reserveMsg.textContent = "Reserve request submitted.";
          } catch (err) {
            reserveMsg.textContent = err.message;
          }
        });
      }

      const rosterBody = document.getElementById("rosterBody");
      if (rosterBody) {
        rosterBody.addEventListener("click", async (e) => {
          const btn = e.target.closest("button");
          if (!btn) return;
          const id = btn.dataset.id;
          const action = btn.dataset.action;
          if (!id || !action) return;
          try {
            if (action === "toggle-checkin") {
              const row = appState.attendees.find((a) => a._id === id);
              await api(`/api/valley/attendees/${id}/check-in`, {
                method: "PATCH",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ checkedIn: !(row && row.checkedIn) })
              });
            }
            if (action === "remove-attendee") {
              await api(`/api/valley/attendees/${id}`, { method: "DELETE" });
            }
            await refreshState();
          } catch (err) {
            memberMsg.textContent = err.message;
          }
        });
      }

      const exportRosterBtn = document.getElementById("exportRosterBtn");
      if (exportRosterBtn) {
        exportRosterBtn.addEventListener("click", () => exportRoster(appState, appState.schedule));
      }

      const clearRosterBtn = document.getElementById("clearRosterBtn");
      if (clearRosterBtn) {
        clearRosterBtn.addEventListener("click", async () => {
          if (!window.confirm("Clear all RSVP/check-in and reserve request data from the shared database?")) return;
          const code = window.prompt("Enter admin code to clear shared data:");
          if (!code) return;
          try {
            await api(`/api/valley/state?code=${encodeURIComponent(code)}`, { method: "DELETE" });
            await refreshState();
          } catch (err) {
            memberMsg.textContent = err.message;
          }
        });
      }
    });
  </script>
</body>
</html>
